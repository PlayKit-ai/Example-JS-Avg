<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Galgame | Agentland</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="styles/spray_i358.PNG">
    <link rel="shortcut icon" type="image/png" href="styles/spray_i358.PNG">
    <link rel="apple-touch-icon" href="styles/spray_i358.PNG">
    <!-- 样式文件 -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/setup.css">
    <link rel="stylesheet" href="styles/gameplay.css">
    <link rel="stylesheet" href="styles/game-ui.css">
    <link rel="stylesheet" href="styles/character.css">
</head>
<body>
    <div id="app">
        <!-- 主菜单界面 -->
        <div id="main-menu" class="main-menu-screen active">
            <div class="canvas-bg"></div>
            <div class="noise"></div>
            <div class="scanline"></div>

            <div class="wrapper">
                <header class="header">
                    <h1 class="title-main">AI Galgame</h1>
                    <p class="title-sub">The Art of Agent Intelligence</p>
                </header>

                <nav class="menu">
                    <button id="btn-new-game" class="nav-item">新建游戏 / INITIALIZE</button>
                    <button id="btn-continue-game" class="nav-item" disabled>继续游戏 / RESUME</button>
                    <button id="btn-load-game" class="nav-item">历史记录 / ARCHIVES</button>
                    <button id="btn-game-settings" class="nav-item">游戏设定 / SETTINGS</button>
                    <button id="btn-exit-game" class="nav-item">退出游戏 / EXIT</button>
                </nav>
            </div>

            <div class="decoration">
                <div class="dec-line">Ourane</div>
                <div class="dec-line">JS SDK Playkit.ai</div>
                <div class="dec-line" id="clock">00:00:00</div>
            </div>
        </div>

        <!-- 角色创建界面 -->
        <div id="character-setup" class="setup-screen">
            <div class="canvas-bg"></div>
            <div class="noise"></div>
            <div class="setup-scanline"></div>

            <div class="setup-wrapper">
                <header>
                    <div class="protocol-title">NEURAL CONNECT PROTOCOL: INITIALIZATION</div>
                    <h1 class="setup-main-title" id="page-title">创建你的角色</h1>
                    <div class="step-bar">
                        <span class="step-label" id="step-info">STEP 01: 用户身份登记</span>
                        <div class="progress-track">
                            <div class="progress-fill" id="p-bar"></div>
                        </div>
                    </div>
                </header>

                <!-- 玩家角色创建 -->
                <div id="step-1" class="step-container active">
                    <form id="player-form">
                        <div class="panel-side">
                            <div class="setup-form-group">
                                <label>昵称 / NICKNAME <span>*</span></label>
                                <input type="text" id="player-nickname" name="nickname" placeholder="请输入昵称" required>
                                <div class="error-message" id="nickname-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>身份 / IDENTITY <span>*</span></label>
                                <input type="text" id="player-identity" name="identity" placeholder="例如：调查员、学生" required>
                                <div class="error-message" id="identity-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性格 / CHARACTER <span>*</span></label>
                                <input type="text" id="player-character" name="character" placeholder="例如：内敛、毒舌" required>
                                <div class="error-message" id="character-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>特质 / TRAITS <span>*</span></label>
                                <input type="text" id="player-traits" name="traits" placeholder="独特的能力或习惯" required>
                                <div class="error-message" id="traits-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性别 / GENDER <span>*</span></label>
                                <div class="setup-gender-row">
                                    <button type="button" class="setup-gender-btn" data-value="male">男</button>
                                    <button type="button" class="setup-gender-btn" data-value="female">女</button>
                                    <button type="button" class="setup-gender-btn" data-value="other">其他</button>
                                </div>
                                <input type="hidden" id="player-gender" name="gender" required>
                                <div class="error-message" id="gender-error"></div>
                            </div>
                        </div>
                        <div class="panel-main">
                            <div class="setup-form-group">
                                <label>人设 / PERSONALITY <span>*</span></label>
                                <textarea id="player-personality" name="personality" placeholder="描述你的角色设定..." required></textarea>
                                <div class="error-message" id="personality-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>世界观 / WORLDVIEW <span>*</span></label>
                                <textarea id="player-background" name="background" placeholder="描述你所处的时空背景..." required></textarea>
                                <div class="error-message" id="background-error"></div>
                            </div>
                            <div class="setup-actions">
                                <button type="submit" class="btn-primary">下一步：配置 AI 角色</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- AI角色创建 -->
                <div id="step-2" class="step-container">
                    <form id="ai-form">
                        <div class="panel-side">
                            <div class="ai-visual-frame disabled" id="ai-avatar-gen">
                                <div class="scanner-line"></div>
                                <div class="gen-status" id="gen-status">需要填写信息</div>
                                <div id="ai-image-placeholder">
                                    <div class="gen-tips"><strong>点击生成 AI 形象</strong><br>神经元连接就绪...</div>
                                </div>
                                <div id="ai-image-loading">
                                    <div class="loading-spinner"></div>
                                    <span style="color: rgba(255,105,180,0.8); font-size: 12px;">正在生成...</span>
                                </div>
                                <img id="ai-preview-image" src="" alt="AI预览">
                            </div>
                            <div class="setup-form-group">
                                <label>AI 昵称 / AI NICKNAME <span>*</span></label>
                                <input type="text" id="ai-nickname" name="nickname" placeholder="给 AI 起个名字" required>
                                <div class="error-message" id="ai-nickname-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性别 / GENDER <span>*</span></label>
                                <div class="setup-gender-row">
                                    <button type="button" class="setup-gender-btn" data-value="male">男</button>
                                    <button type="button" class="setup-gender-btn" data-value="female">女</button>
                                    <button type="button" class="setup-gender-btn" data-value="other">其他</button>
                                </div>
                                <input type="hidden" id="ai-gender" name="gender" required>
                                <div class="error-message" id="ai-gender-error"></div>
                            </div>
                        </div>
                        <div class="panel-main">
                            <div class="setup-form-group">
                                <label>设定（决定回复效果）<span>*</span></label>
                                <textarea id="ai-settings" name="settings" placeholder="描述 AI 的性格倾向、说话方式..." required></textarea>
                                <div class="error-message" id="settings-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>外观描述/穿搭风格 <span>*</span></label>
                                <textarea id="ai-appearance" name="appearance" class="short" placeholder="例如：银发蓝瞳，穿着黑色燕尾服..." required></textarea>
                                <div class="error-message" id="appearance-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>开场白 / OPENING <span>*</span></label>
                                <input type="text" id="ai-opening" name="opening" placeholder="AI 见你说的第一句话..." required>
                                <div class="error-message" id="opening-error"></div>
                            </div>
                            <div class="setup-actions">
                                <button type="button" class="btn-back" id="back-to-step1">返回上一步</button>
                                <button type="submit" class="btn-primary">建立连接 / START GAME</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-main" class="game-screen">
            <!-- 背景层 -->
            <div class="game-background">
                <img id="background-image" class="background-image" src="" alt="场景背景" style="display: none;">
                <div id="background-loading" class="background-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>正在生成场景背景...</p>
                </div>
            </div>

            <!-- 角色立绘层 -->
            <div class="character-layer">
                <div id="character-image-container" class="character-container">
                    <img id="character-image" src="" alt="AI角色" class="character-sprite" style="display: none;">
                    <div id="image-loading" class="character-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>正在生成角色形象...</p>
                    </div>
                </div>
            </div>

            <!-- UI层 -->
            <div class="ui-layer">
                <!-- 选择按钮区域 -->
                <div class="choice-area" id="choice-area" style="display: none;"></div>

                <!-- 底部UI区域 -->
                <div class="bottom-ui">
                    <!-- 对话框 -->
                    <div class="dialogue-box">
                        <div id="character-name" class="character-name-box">
                            <span id="character-name-text">夏栀</span>
                        </div>
                        <div class="dialogue-content">
                            <div id="dialogue-text" class="dialogue-text"></div>
                            <div class="dialogue-indicator">▼</div>
                        </div>
                    </div>

                    <!-- 底部控制区域 -->
                    <div class="bottom-controls">
                        <!-- 聊天历史记录框 -->
                        <div class="chat-history-area" id="chat-history-area">
                            <div class="chat-history-header">
                                <span>聊天记录</span>
                                <button id="toggle-history" class="history-toggle-btn">▲</button>
                            </div>
                            <div class="chat-history-content" id="chat-history-content">
                                <div class="chat-history-messages" id="chat-history-messages"></div>
                            </div>
                        </div>

                        <!-- 输入区域 -->
                        <div class="input-area" id="input-area">
                            <div class="input-container">
                                <textarea id="player-input" placeholder="输入你想说的话..." maxlength="500"></textarea>
                                <button id="send-message" class="send-btn">发送</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 游戏菜单 -->
                <div class="game-menu">
                    <button class="menu-btn" id="menu-save">保存</button>
                    <button class="menu-btn" id="menu-load">读取</button>
                    <button class="menu-btn" id="menu-config">设置</button>
                    <button class="menu-btn" id="menu-exit">退出</button>
                </div>
            </div>
        </div>

        <!-- 加载遮罩 -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-text">加载中...</p>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="js/models/CharacterProfile.js"></script>
    <script src="js/systems/DialogueSystem.js"></script>
    <script src="js/systems/ImageGenerationSystem.js"></script>
    <script src="js/systems/BGMSystem.js"></script>
    <script src="js/managers/GameSessionManager.js"></script>
    <script src="js/managers/StorageManager.js"></script>
    <script src="js/main.js"></script>

    <!-- 时钟更新脚本 -->
    <script>
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const clockElement = document.getElementById('clock');
            if (clockElement) {
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
