<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Galgame | Agentland</title>
    <script src="https://unpkg.com/playkit-sdk@latest/dist/playkit-sdk.umd.js"></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="styles/spray_i358.PNG">
    <link rel="shortcut icon" type="image/png" href="styles/spray_i358.PNG">
    <link rel="apple-touch-icon" href="styles/spray_i358.PNG">
    <!-- 样式文件 -->
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/setup.css">
    <link rel="stylesheet" href="styles/gameplay.css">
    <link rel="stylesheet" href="styles/game-ui.css">
    <link rel="stylesheet" href="styles/character.css">
    <link rel="stylesheet" href="styles/settings.css">
</head>
<body>
    <div id="app">
        <!-- 主菜单界面 -->
        <div id="main-menu" class="main-menu-screen active">
            <div class="canvas-bg"></div>
            <div class="noise"></div>
            <div class="scanline"></div>

            <div class="wrapper">
                <header class="header">
                    <h1 class="title-main">AI Galgame</h1>
                    <p class="title-sub">The Art of Agent Intelligence</p>
                </header>

                <nav class="menu">
                    <button id="btn-new-game" class="nav-item">新建游戏 / INITIALIZE</button>
                    <button id="btn-continue-game" class="nav-item" disabled>继续游戏 / RESUME</button>
                    <button id="btn-load-game" class="nav-item">历史记录 / ARCHIVES</button>
                    <button id="btn-game-settings" class="nav-item">游戏设定 / SETTINGS</button>
                    <button id="btn-exit-game" class="nav-item">退出游戏 / EXIT</button>
                </nav>
            </div>

            <div class="decoration">
                <div class="dec-line">Ourane</div>
                <div class="dec-line">JS SDK Playkit.ai</div>
                <div class="dec-line" id="clock">00:00:00</div>
            </div>
        </div>

        <!-- 角色创建界面 -->
        <div id="character-setup" class="setup-screen">
            <div class="canvas-bg"></div>
            <div class="noise"></div>
            <div class="setup-scanline"></div>

            <div class="setup-wrapper">
                <header>
                    <div class="protocol-title">NEURAL CONNECT PROTOCOL: INITIALIZATION</div>
                    <h1 class="setup-main-title" id="page-title">创建你的角色</h1>
                    <div class="step-bar">
                        <span class="step-label" id="step-info">STEP 01: 用户身份登记</span>
                        <div class="progress-track">
                            <div class="progress-fill" id="p-bar"></div>
                        </div>
                    </div>
                </header>

                <!-- 玩家角色创建 -->
                <div id="step-1" class="step-container active">
                    <form id="player-form">
                        <div class="panel-side">
                            <div class="setup-form-group">
                                <label>昵称 / NICKNAME <span>*</span></label>
                                <input type="text" id="player-nickname" name="nickname" placeholder="请输入昵称" required>
                                <div class="error-message" id="nickname-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>身份 / IDENTITY <span>*</span></label>
                                <input type="text" id="player-identity" name="identity" placeholder="例如：调查员、学生" required>
                                <div class="error-message" id="identity-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性格 / CHARACTER <span>*</span></label>
                                <input type="text" id="player-character" name="character" placeholder="例如：内敛、毒舌" required>
                                <div class="error-message" id="character-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>特质 / TRAITS <span>*</span></label>
                                <input type="text" id="player-traits" name="traits" placeholder="独特的能力或习惯" required>
                                <div class="error-message" id="traits-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性别 / GENDER <span>*</span></label>
                                <div class="setup-gender-row">
                                    <button type="button" class="setup-gender-btn" data-value="male">男</button>
                                    <button type="button" class="setup-gender-btn" data-value="female">女</button>
                                    <button type="button" class="setup-gender-btn" data-value="other">其他</button>
                                </div>
                                <input type="hidden" id="player-gender" name="gender" required>
                                <div class="error-message" id="gender-error"></div>
                            </div>
                        </div>
                        <div class="panel-main">
                            <div class="setup-form-group">
                                <label>人设 / PERSONALITY <span>*</span></label>
                                <textarea id="player-personality" name="personality" placeholder="描述你的角色设定..." required></textarea>
                                <div class="error-message" id="personality-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>世界观 / WORLDVIEW <span>*</span></label>
                                <textarea id="player-background" name="background" placeholder="描述你所处的时空背景..." required></textarea>
                                <div class="error-message" id="background-error"></div>
                            </div>
                            <div class="setup-actions">
                                <button type="submit" class="btn-primary">下一步：配置 AI 角色</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- AI角色创建 -->
                <div id="step-2" class="step-container">
                    <form id="ai-form">
                        <div class="panel-side">
                            <div class="ai-visual-frame disabled" id="ai-avatar-gen">
                                <div class="scanner-line"></div>
                                <div class="gen-status" id="gen-status">需要填写信息</div>
                                <div id="ai-image-placeholder">
                                    <div class="gen-tips"><strong>点击生成 AI 形象</strong><br>神经元连接就绪...</div>
                                </div>
                                <div id="ai-image-loading">
                                    <div class="loading-spinner"></div>
                                    <span style="color: rgba(255,105,180,0.8); font-size: 12px;">正在生成...</span>
                                </div>
                                <img id="ai-preview-image" src="" alt="AI预览">
                            </div>
                            <div class="setup-form-group">
                                <label>AI 昵称 / AI NICKNAME <span>*</span></label>
                                <input type="text" id="ai-nickname" name="nickname" placeholder="给 AI 起个名字" required>
                                <div class="error-message" id="ai-nickname-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>性别 / GENDER <span>*</span></label>
                                <div class="setup-gender-row">
                                    <button type="button" class="setup-gender-btn" data-value="male">男</button>
                                    <button type="button" class="setup-gender-btn" data-value="female">女</button>
                                    <button type="button" class="setup-gender-btn" data-value="other">其他</button>
                                </div>
                                <input type="hidden" id="ai-gender" name="gender" required>
                                <div class="error-message" id="ai-gender-error"></div>
                            </div>
                        </div>
                        <div class="panel-main">
                            <div class="setup-form-group">
                                <label>设定（决定回复效果）<span>*</span></label>
                                <textarea id="ai-settings" name="settings" placeholder="描述 AI 的性格倾向、说话方式..." required></textarea>
                                <div class="error-message" id="settings-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>外观描述/穿搭风格 <span>*</span></label>
                                <textarea id="ai-appearance" name="appearance" class="short" placeholder="例如：银发蓝瞳，穿着黑色燕尾服..." required></textarea>
                                <div class="error-message" id="appearance-error"></div>
                            </div>
                            <div class="setup-form-group">
                                <label>开场白 / OPENING <span>*</span></label>
                                <input type="text" id="ai-opening" name="opening" placeholder="AI 见你说的第一句话..." required>
                                <div class="error-message" id="opening-error"></div>
                            </div>
                            <div class="setup-actions">
                                <button type="button" class="btn-back" id="back-to-step1">返回上一步</button>
                                <button type="submit" class="btn-primary">建立连接 / START GAME</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-main" class="game-screen">
            <!-- 背景层 -->
            <div class="game-background">
                <img id="background-image" class="background-image" src="" alt="场景背景" style="display: none;">
                <div id="background-loading" class="background-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>正在生成场景背景...</p>
                </div>
            </div>

            <!-- 角色立绘层 -->
            <div class="character-layer">
                <div id="character-image-container" class="character-container">
                    <img id="character-image" src="" alt="AI角色" class="character-sprite" style="display: none;">
                    <div id="image-loading" class="character-loading" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p>正在生成角色形象...</p>
                    </div>
                </div>
            </div>

            <!-- UI层 -->
            <div class="ui-layer">
                <!-- 选择按钮区域 -->
                <div class="choice-area" id="choice-area" style="display: none;"></div>

                <!-- 底部UI区域 -->
                <div class="bottom-ui">
                    <!-- 对话框 -->
                    <div class="dialogue-box">
                        <div id="character-name" class="character-name-box">
                            <span id="character-name-text">夏栀</span>
                        </div>
                        <div class="dialogue-content">
                            <div id="dialogue-text" class="dialogue-text"></div>
                            <div class="dialogue-indicator">▼</div>
                        </div>
                    </div>

                    <!-- 底部控制区域 -->
                    <div class="bottom-controls">
                        <!-- 聊天历史记录框 -->
                        <div class="chat-history-area" id="chat-history-area">
                            <div class="chat-history-header">
                                <span>聊天记录</span>
                                <button id="toggle-history" class="history-toggle-btn">▲</button>
                            </div>
                            <div class="chat-history-content" id="chat-history-content">
                                <div class="chat-history-messages" id="chat-history-messages"></div>
                            </div>
                        </div>

                        <!-- 输入区域 -->
                        <div class="input-area" id="input-area">
                            <div class="input-container">
                                <textarea id="player-input" placeholder="输入你想说的话..." maxlength="500"></textarea>
                                <button id="send-message" class="send-btn">发送</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 游戏菜单 -->
                <div class="game-menu">
                    <button class="menu-btn" id="menu-save">保存</button>
                    <button class="menu-btn" id="menu-load">读取</button>
                    <button class="menu-btn" id="menu-config">设置</button>
                    <button class="menu-btn" id="menu-exit">退出</button>
                </div>
            </div>
        </div>

        <!-- 设置弹窗 -->
        <div id="settings-modal" class="settings-modal">
            <div class="settings-container">
                <div class="settings-header">
                    <h2>游戏设定</h2>
                    <button id="settings-close" class="settings-close-btn">×</button>
                </div>
                
                <div class="settings-content">
                    <!-- 音频设置 -->
                    <div class="settings-section">
                        <h3>🔊 音频设置</h3>
                        <div class="settings-item">
                            <label>BGM音量</label>
                            <div class="slider-container">
                                <input type="range" id="setting-bgm-volume" min="0" max="100" value="50">
                                <span id="bgm-volume-value">50%</span>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>BGM开关</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-bgm-enabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="settings-item">
                            <label>音效音量 <span class="tag-reserved">(预留)</span></label>
                            <div class="slider-container">
                                <input type="range" id="setting-sfx-volume" min="0" max="100" value="50">
                                <span id="sfx-volume-value">50%</span>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>音效开关 <span class="tag-reserved">(预留)</span></label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-sfx-enabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- 显示设置 -->
                    <div class="settings-section">
                        <h3>🖥️ 显示设置</h3>
                        <div class="settings-item">
                            <label>界面缩放</label>
                            <div class="button-group">
                                <button class="scale-btn" data-scale="0.8">80%</button>
                                <button class="scale-btn" data-scale="1.0">100%</button>
                                <button class="scale-btn" data-scale="1.2">120%</button>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>对话文字速度</label>
                            <div class="button-group">
                                <button class="speed-btn" data-speed="slow">慢</button>
                                <button class="speed-btn" data-speed="medium">中</button>
                                <button class="speed-btn" data-speed="fast">快</button>
                            </div>
                        </div>
                        <div class="settings-item">
                            <label>自动播放延迟</label>
                            <div class="button-group">
                                <button class="delay-btn" data-delay="2000">2秒</button>
                                <button class="delay-btn" data-delay="3000">3秒</button>
                                <button class="delay-btn" data-delay="5000">5秒</button>
                                <button class="delay-btn" data-delay="8000">8秒</button>
                            </div>
                        </div>
                    </div>

                    <!-- 游戏设置 -->
                    <div class="settings-section">
                        <h3>⚙️ 游戏设置</h3>
                        <div class="settings-item">
                            <label>自动保存</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-auto-save" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- API配置 -->
                    <div class="settings-section">
                        <h3>🔑 API配置</h3>
                        <div class="settings-item column">
                            <label>Game ID</label>
                            <input type="text" id="setting-game-id" class="settings-input" placeholder="your-game-id">
                        </div>
                        <div class="settings-item column">
                            <label>Developer Token</label>
                            <input type="password" id="setting-token" class="settings-input" placeholder="your-developer-token">
                        </div>
                        <div class="settings-item column">
                            <label>Base URL</label>
                            <input type="text" id="setting-base-url" class="settings-input" placeholder="https://playkit.ai">
                        </div>
                        <div class="settings-item">
                            <label>默认AI模型</label>
                            <select id="setting-chat-model" class="settings-select">
                                <option value="Qwen3-235B">Qwen3-235B</option>
                                <option value="Qwen3-32B">Qwen3-32B</option>
                                <option value="gpt-4o">GPT-4o</option>
                                <option value="gpt-4o-mini">GPT-4o-mini</option>
                                <option value="claude-3-5-sonnet">Claude-3.5-Sonnet</option>
                            </select>
                        </div>
                        <div class="settings-item">
                            <label>默认图像模型</label>
                            <select id="setting-image-model" class="settings-select">
                                <option value="gpt-image-1">GPT-Image-1</option>
                                <option value="dall-e-3">DALL-E 3</option>
                                <option value="nano-banana">Nano-Banana</option>
                            </select>
                        </div>
                    </div>

                    <!-- 数据管理 -->
                    <div class="settings-section">
                        <h3>🗂️ 数据管理</h3>
                        <div class="settings-item">
                            <label>清除所有缓存</label>
                            <button id="btn-clear-all-cache" class="settings-action-btn danger">清除</button>
                        </div>
                        <div class="settings-item">
                            <label>清除图像缓存</label>
                            <button id="btn-clear-image-cache" class="settings-action-btn warning">清除</button>
                        </div>
                        <div class="settings-item">
                            <label>清除对话历史</label>
                            <button id="btn-clear-dialogue" class="settings-action-btn warning">清除</button>
                        </div>
                    </div>

                    <!-- 关于 -->
                    <div class="settings-section">
                        <h3>ℹ️ 关于</h3>
                        <div class="settings-item">
                            <label>版本信息</label>
                            <span class="settings-value">v1.0.0</span>
                        </div>
                        <div class="settings-item">
                            <label>使用说明</label>
                            <button id="btn-show-help" class="settings-action-btn">查看</button>
                        </div>
                    </div>
                </div>

                <div class="settings-footer">
                    <button id="settings-reset" class="settings-btn secondary">恢复默认</button>
                    <button id="settings-save" class="settings-btn primary">保存设置</button>
                </div>
            </div>
        </div>

        <!-- 使用说明弹窗 -->
        <div id="help-modal" class="help-modal">
            <div class="help-container">
                <div class="help-header">
                    <h2>使用说明</h2>
                    <button id="help-close" class="settings-close-btn">×</button>
                </div>
                <div class="help-content">
                    <h3>🎮 游戏简介</h3>
                    <p>AI Galgame 是一款基于人工智能的视觉小说游戏。你可以创建自己的角色，与AI角色进行互动对话，体验独特的故事。</p>
                    
                    <h3>📝 快速开始</h3>
                    <ol>
                        <li>点击「新建游戏」创建你的角色</li>
                        <li>填写玩家角色信息（昵称、性别、人设等）</li>
                        <li>配置AI角色（外观、性格、开场白等）</li>
                        <li>开始与AI角色对话互动</li>
                    </ol>
                    
                    <h3>⚙️ API配置说明</h3>
                    <p>本游戏使用 PlayKit SDK 进行AI对话和图像生成。你需要：</p>
                    <ul>
                        <li><strong>Game ID</strong>: 你的游戏项目ID</li>
                        <li><strong>Token</strong>: 开发者令牌</li>
                        <li><strong>Base URL</strong>: API服务地址</li>
                    </ul>
                    
                    <h3>💾 存档说明</h3>
                    <ul>
                        <li>游戏数据自动保存到浏览器本地存储</li>
                        <li>可导出存档文件进行备份</li>
                        <li>存档文件保存在 saved_games 文件夹</li>
                    </ul>
                    
                    <h3>🎵 快捷键</h3>
                    <ul>
                        <li><strong>Enter</strong>: 发送消息</li>
                        <li><strong>Shift + Enter</strong>: 换行</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 加载遮罩 -->
        <div id="loading-overlay" class="loading-overlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <p id="loading-text">加载中...</p>
            </div>
        </div>
    </div>

    <!-- JavaScript 文件 -->
    <script src="js/models/CharacterProfile.js"></script>
    <script src="js/systems/DialogueSystem.js"></script>
    <script src="js/systems/ImageGenerationSystem.js"></script>
    <script src="js/systems/BGMSystem.js"></script>
    <script src="js/managers/GameSessionManager.js"></script>
    <script src="js/managers/StorageManager.js"></script>
    <script src="js/main.js"></script>

    <!-- 时钟更新脚本 -->
    <script>
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const clockElement = document.getElementById('clock');
            if (clockElement) {
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>
